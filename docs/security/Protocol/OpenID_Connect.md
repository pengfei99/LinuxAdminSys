# OpenID Connect

*OpenID Connect* is an `interoperable authentication protocol` based on the OAuth 2.0 framework of 
specifications (IETF RFC 6749 and 6750). It simplifies the way to verify the identity of users based on 
the authentication performed by an Authorization Server and to obtain user profile information in an 
interoperable and REST-like manner.

OpenID Connect enables application and website developers to launch sign-in flows and receive verifiable 
assertions about users across Web-based, mobile, and JavaScript clients. And the specification suite is 
extensible to support a range of optional features such as encryption of identity data, discovery of 
OpenID Providers, and session logout.

**It delegates the user authentication and provisioning to a dedicated, purpose-built service, called an Identity Provider (IdP)**


## 1. The key point of OpenID connect (OIDC)

- The secure Json Web Token(JWT): A wide range of signature and encryption algorithms. All that makes JWT outstanding 
   for the ID token job.
- One protocol for authentication and authorisation(to obtain the access token): The JWT token is obtained via a 
   standard OAuth 2.0 flow. In another word, **OpenID Connect (OIDC) is an authentication protocol built 
    on top of the OAuth 2.0 framework**.

## 2. The OpenID token (JWT)

For more details about the parameters inside the token, you can visit this [page](https://openid.net/specs/openid-connect-core-1_0.html#IDToken).


The ID token resembles the concept of an identity card, in a standard JWT format, signed by the OpenID Provider (OP). 
To obtain one the client needs to send the user to their OP with an authentication request.

Features/Parameters of the ID token:

- **sub**: aka `subject`, which represents the identity of the user.
- **iss**: Specifies the issuing authority.
- **aud**: Specifies who is the intended audience for the token. i.e., the recipient who should process the token. 
            It typically contains the client ID of the application that requested the token.
- **exp**: aka. `The expiration time` indicates when the token becomes invalid. It is represented as a Unix timestamp.
- **iat**: aka. `Issued at time` indicates when the token was issued, represented as a Unix timestamp. 
- **nbf**: aka. `not before` specifies the time(Unix timestamp) before which the token should not be accepted for processing.
- **auth_time**: `Authentication time` indicates the time when the user was authenticated by the OIDC provider. It can 
                  be useful for applications that require knowledge of when the user last authenticated.
- **nonce**: The nonce is a random value generated by the client and included in the authentication request. It helps 
             prevent replay attacks by ensuring that the response corresponds to a specific request.
- **token_type**: `Token Type` specifies the type of token. For OIDC identity tokens, the value is typically **Bearer**
             indicating that the token can be used as a bearer token to access protected resources.
- **scope**: The `scope` parameter indicates the permissions granted to the client. It specifies the scope of 
             access requested by the client during authentication.

The below json file is an example of the OIDC token:

```json
{
  "iss": "https://oidc-provider.com",
  "sub": "toto",
  "aud": "shop123",
  "exp": 1648820763,
  "iat": 1648817163,
  "nbf": 1648817163,
  "auth_time": 1648817155,
  "nonce": "abc123",
  "token_type": "Bearer",
  "scope": "openid profile email"
}
```

## 3. How to request an ID token

Now that we know what an ID token is, how can `a client, called Relying Party (RP)` in OpenID Connect, request an ID token?

### Use a trusted agent

Authentication must take place at the `identity provider`, where the user's session or credentials will be checked. 
For that a trusted agent is required, and this role is usually performed by the web browser.

`A browser popup page` is the preferred way for a web application to redirect the user to the IdP. Mobile apps on 
platforms such as Android or iOS should launch the system browser for that purpose. **Embedded web views are not be trusted**, 
as there is nothing to prevent the app from snooping on the user password. 

> User authentication must always occur in a trusted context that is separate from the app (e.g. the browser).

Note that OpenID Connect doesn't specify how users should actually be authenticated, this is left up to the IdP to decide.

### Authorisation workflow

We have seen the different authorisation workflow of the OAuth protocol. As OpenID connect is built above OAuth, it can
use three flows to obtain the OpenID connect token:

- **Authorisation code flow**: the most commonly used flow, intended for traditional web apps as well 
       as native / mobile apps. Involves an initial browser redirection to / from the OP for user authentication 
       and consent, then a second back-channel request to retrieve the ID token. This flow offers optimal security, 
       as tokens are not exposed to the browser and the client can also be authenticated.

- **Implicit flow**: for browser (JavaScript) based apps that don't have a backend. The ID token is received 
         directly with the redirection response from the OP. No back-channel request is required here.

- **Hybrid flow**: rarely used, allows the application front-end and back-end to receive tokens separately 
        from one another. Essentially a combination of the code and implicit flows.



